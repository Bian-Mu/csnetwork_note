运输层协议只工作在端系统中，将来自应用进程的报文移动到网络层，反向也是运输层。中间路由器不识别任何运输层附加在报文上的信息

运输层提供的服务一定程度受制于网络层

### 运输层概述

UDP（用户数据报协议）、TCP（传输控制协议）。

网络层的IP（网际协议）尽可能传递来自运输层的报文段，但不作任何确保，所以是不可靠的。而运输层协议的基本责任是：将两个端系统间IP的交付服务扩展为运行在端系统上两个进程之间的交付服务。简单来说，从“主机交付”扩展为“进程交付”，其中主要依靠了运输层的多路复用与多路分解。

UDP：数据交付、报文段首部差错检查字段
TCP：上述、可靠数据传输、拥塞控制

### 多路复用与多路分解

对于一个目的主机，在接收到报文段后，要通过运输层交付到合适的应用层进程中（实际上是交给了套接字）。

多路分解：接收方运输层通过报文段中数个字段实现套接字定向，交付给应用层。
多路复用：发送方在主机的不同套接字收集数据块，为每个数据块封装首部信息形成报文段，交付给网络层

基础的报文段格式如下：源端口号（16bit）、目的端口号（16bit）
其中0˜ˋ1023是周知端口号，受到保留。运输层通过端口号配对套接字

#### UDP的多路复用与分解
通常服务端要指定特定端口，而客户端的运输层自动分配即可。

源端口号作为“返回地址”，当目的进程需要回发时取值。

UDP套接字是一个二元组标识的：目的IP地址、目的端口号，在检查套接字后，两个不同源但同目的的报文段会被接入同一个套接字进入同一个进程。

#### TCP的多路复用与分解
TCP套接字是四元组：源IP、源端口、目的IP、目的端口。检查套接字后，两个不同源的报文段绘本定向到两个不同的套接字，除非报文段中有“初始创建连接”的请求。在连接之后到达的、四元组相同的报文段会进入连接的进程。

事实上，现今Web服务器一般只使用一个进程，而是为每个TCP连接创建一个具有套接字的新“线程”。

非持续HTTP会导致TCP连接的反复创建关闭影响Web服务器性能


### UDP的运输
