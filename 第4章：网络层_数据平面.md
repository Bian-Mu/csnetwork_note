网络层分为两个相互作用的平面：数据平面、控制平面

数据平面功能即网络层中每台路由器的功能，决定了到达路由器输入链路之一的数据报如何转发到路由器的输出链路之一

控制平面功能即网络范围的逻辑，控制着数据报沿着源主机到目的主机的端到端路劲中，路由器之间的路由方式

### 网络层概述

路由器是不运行高层协议的

#### 转发和路由选择

![[Screenshot_2024-12-20-13-57-40-089_com.flyersoft.moonreaderp.png]]
##### 转发
当一个分组到达某路由器的一条输入链路时，路由器要将该分组移动到适合的输出链路，转发是数据平面的唯一功能，路由器也可以阻挡源、目的有问题的分组。

属于路由器本地操作，尺度很短（通常为纳秒），依靠硬件实现。

每台路由器中都有关键元素：转发表。路由器检查分组首部的一些字段，依靠这些字段值在转发表中查询。

##### 路由选择
当分组从发送方流向接收方时，网络层必须决定分组采用的路由/路径。决定方式取决于路由选择算法

属于网络范围处理过程，尺度较大（通常为秒），依靠软件实现

路由选择算法：决定了插入路由器的转发表中的内容，路由器之间通过该算法通信，计算出转发表中的值（见上图）

SDN（软件定义网络）：也是用于确定转发表内容的。远程控制器来计算和分发转发表以供路由器使用，SDN通常交给第三方管理，此时路由器不接入算法，只进行转发（见下图）
![[Screenshot_2024-12-20-14-04-35-443_md.obsidian.png]]

#### 网络服务模型
定义了分组在发送和接收主机之间的端到端传输特性。

网络层通常提供以下服务：
- 确保交付：分组会到达目的地
- 具有时延上界的确保交付：分组会到达目的地，并且会在规定时间内交付
- 有序分组交付：分组会按照发送顺序到达目的地
- 确保最小带宽：模仿发送方和接收方之间一条特定比特率X bps的传输链路的行为。只要发送方不超过X，则分组会到达目的地
- 安全性：在源加密所有数据报、在目的解密

通常情况下，因特网的网络层服务（只提供发送分组的尽力而为服务，什么都不保证）+适当带宽供给+带宽自适应应用级协议的结合，可以满足大量应用所需

链路层交换机：基于链路层帧的字段的值做出决定
路由器：基于网络层数据报首部字段值做出转发决定，这是本章所讲的

### 路由器工作原理